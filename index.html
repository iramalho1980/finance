<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, #000000 0%, #434343 50%, #c0c0c0 100%);
            min-height: 100vh;
            color: #ffffff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4a90e2;
            text-shadow: 0 0 20px rgba(74, 144, 226, 0.5);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            border-radius: 25px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transition: transform 0.3s ease-in-out;
        }

        .card h2 {
            color: #4a90e2;
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #ffffff;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="date"],
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 1rem;
            transition: all 0.3s ease-in-out;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="number"]:focus,
        .form-group input[type="date"]:focus,
        .form-group select:focus {
            border-color: #4a90e2;
            background: rgba(74, 144, 226, 0.15);
            outline: none;
            box-shadow: 0 0 10px rgba(74, 144, 226, 0.3);
        }

        .form-group select {
            cursor: pointer;
        }

        .form-group select option {
            background: #2c2c2c;
            color: #ffffff;
            padding: 10px;
        }

        .form-group select option:checked,
        .form-group select option:hover {
            background: #4a90e2 !important;
            color: #ffffff !important;
            font-weight: bold;
        }

        .form-group select option:selected {
            background: linear-gradient(135deg, #4a90e2, #357ABD) !important;
            color: #ffffff !important;
            font-weight: bold;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            transition: all 0.3s ease-in-out;
            flex: 1;
            min-width: 120px;
        }

        .button.primary {
            background-color: #4a90e2;
            color: #ffffff;
        }

        .button.primary:hover {
            background-color: #357ABD;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.4);
        }

        .button.secondary {
            background-color: #6c757d;
            color: #ffffff;
        }

        .button.secondary:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.4);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin-top: 20px;
        }

        .table-container {
            margin-top: 20px;
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: left;
            white-space: nowrap;
        }

        .data-table th {
            background-color: rgba(74, 144, 226, 0.3);
            font-weight: 700;
            color: #ffffff;
        }

        .data-table tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .data-table tr:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .total-card {
            grid-column: span 2;
            text-align: center;
            padding: 20px;
            background: rgba(74, 144, 226, 0.2);
            border-radius: 20px;
            border: 1px solid rgba(74, 144, 226, 0.5);
            margin-top: 20px;
        }

        .total-card h2 {
            color: #ffffff;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .total-card p {
            font-size: 1.5rem;
            font-weight: 700;
            color: #a7d9ff;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .export-buttons .button {
            background-color: #28a745;
            flex: none;
        }

        .export-buttons .button:hover {
            background-color: #218838;
        }

        .search-group {
            margin-bottom: 20px;
        }

        .search-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 1rem;
            transition: all 0.3s ease-in-out;
        }

        .search-group input:focus {
            border-color: #4a90e2;
            background: rgba(74, 144, 226, 0.15);
            outline: none;
            box-shadow: 0 0 10px rgba(74, 144, 226, 0.3);
        }

        .sortable-handle {
            cursor: grab;
            margin-right: 10px;
        }

        .data-table td .action-buttons {
            display: flex;
            gap: 5px;
        }

        .data-table td .action-buttons .button {
            padding: 8px 12px;
            font-size: 0.9rem;
            flex: none;
            min-width: auto;
        }

        .data-table td .action-buttons .button.edit {
            background-color: #ffc107;
            color: #333;
        }

        .data-table td .action-buttons .button.edit:hover {
            background-color: #e0a800;
        }

        .data-table td .action-buttons .button.delete {
            background-color: #dc3545;
            color: #fff;
        }

        .data-table td .action-buttons .button.delete:hover {
            background-color: #c82333;
        }

        /* Placeholder styling for better visibility */
        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .search-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .total-card {
                grid-column: span 1;
            }

            .button-group {
                flex-direction: column;
            }

            .export-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Controle Financeiro Pessoal</h1>
        </div>

        <div class="main-grid">
            <div class="card">
                <h2>Adicionar Transação</h2>
                <div class="form-group">
                    <label for="descricao">Descrição:</label>
                    <input type="text" id="descricao" placeholder="Ex: Salário, Aluguel, Compras" required>
                </div>
                <div class="form-group">
                    <label for="valor">Valor:</label>
                    <input type="number" id="valor" placeholder="Ex: 1500.00" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="tipo">Tipo:</label>
                    <select id="tipo">
                        <option value="receita">Receita</option>
                        <option value="despesa">Despesa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="data">Data:</label>
                    <input type="date" id="data" required>
                </div>
                <div class="button-group">
                    <button class="button primary" id="adicionarTransacao">Adicionar Transação</button>
                    <button class="button secondary" id="limparFormulario">Limpar</button>
                    <button class="button primary" id="salvarGitHub">Salvar</button>
                </div>
            </div>

            <div class="card">
                <h2>Resumo Financeiro</h2>
                <div class="chart-container">
                    <canvas id="resumoChart"></canvas>
                </div>
                <div class="total-card">
                    <h2>Saldo Total</h2>
                    <p id="saldoTotal">R$ 0.00</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Extrato de Transações</h2>
            <div class="search-group">
                <input type="text" id="filtroDescricao" placeholder="Filtrar por descrição...">
            </div>
            <div class="table-container">
                <table class="data-table" id="tabelaTransacoes">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Descrição</th>
                            <th>Valor</th>
                            <th>Tipo</th>
                            <th>Data</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Transações serão adicionadas aqui -->
                    </tbody>
                </table>
            </div>
            <div class="export-buttons">
                <button class="button primary" id="exportarPdf">Exportar para PDF</button>
                <button class="button primary" id="exportarCsv">Exportar para CSV</button>
            </div>
        </div>
    </div>

    <script>
        const descricaoInput = document.getElementById('descricao');
        const valorInput = document.getElementById('valor');
        const tipoInput = document.getElementById('tipo');
        const dataInput = document.getElementById('data');
        const adicionarTransacaoBtn = document.getElementById('adicionarTransacao');
        const limparFormularioBtn = document.getElementById('limparFormulario');
        const salvarGitHubBtn = document.getElementById('salvarGitHub');
        const saldoTotalElement = document.getElementById('saldoTotal');
        const tabelaTransacoesBody = document.querySelector('#tabelaTransacoes tbody');
        const filtroDescricaoInput = document.getElementById('filtroDescricao');
        const exportarPdfBtn = document.getElementById('exportarPdf');
        const exportarCsvBtn = document.getElementById('exportarCsv');

        let transacoes = [];
        let resumoChart;
        let editandoIndex = -1;

        // Definir data atual como padrão
        dataInput.value = new Date().toISOString().split('T')[0];

        // Função para carregar transações do localStorage
        function carregarTransacoes() {
            const transacoesSalvas = localStorage.getItem('transacoes');
            if (transacoesSalvas) {
                transacoes = JSON.parse(transacoesSalvas);
                renderizarTransacoes();
                atualizarResumoFinanceiro();
            }
        }

        // Função para salvar transações no localStorage
        function salvarTransacoes() {
            localStorage.setItem('transacoes', JSON.stringify(transacoes));
        }

        // Função para adicionar transação
        function adicionarTransacao() {
            const descricao = descricaoInput.value.trim();
            const valor = parseFloat(valorInput.value);
            const tipo = tipoInput.value;
            const data = dataInput.value;

            if (!descricao || !valor || !data) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }

            if (valor <= 0) {
                alert('O valor deve ser maior que zero.');
                return;
            }

            const transacao = {
                id: Date.now(),
                descricao,
                valor,
                tipo,
                data
            };

            if (editandoIndex >= 0) {
                transacoes[editandoIndex] = transacao;
                editandoIndex = -1;
                adicionarTransacaoBtn.textContent = 'Adicionar Transação';
            } else {
                transacoes.push(transacao);
            }

            salvarTransacoes();
            renderizarTransacoes();
            atualizarResumoFinanceiro();
            limparFormulario();
        }

        // Função para limpar formulário
        function limparFormulario() {
            descricaoInput.value = '';
            valorInput.value = '';
            tipoInput.value = 'receita';
            dataInput.value = new Date().toISOString().split('T')[0];
            editandoIndex = -1;
            adicionarTransacaoBtn.textContent = 'Adicionar Transação';
        }

        // Função para editar transação
        function editarTransacao(index) {
            const transacao = transacoes[index];
            descricaoInput.value = transacao.descricao;
            valorInput.value = transacao.valor;
            tipoInput.value = transacao.tipo;
            dataInput.value = transacao.data;
            editandoIndex = index;
            adicionarTransacaoBtn.textContent = 'Atualizar Transação';
        }

        // Função para excluir transação
        function excluirTransacao(index) {
            if (confirm('Tem certeza que deseja excluir esta transação?')) {
                transacoes.splice(index, 1);
                salvarTransacoes();
                renderizarTransacoes();
                atualizarResumoFinanceiro();
            }
        }

        // Função para renderizar transações na tabela
        function renderizarTransacoes() {
            const filtro = filtroDescricaoInput.value.toLowerCase();
            const transacoesFiltradas = transacoes.filter(transacao =>
                transacao.descricao.toLowerCase().includes(filtro)
            );

            tabelaTransacoesBody.innerHTML = '';

            transacoesFiltradas.forEach((transacao, index) => {
                const originalIndex = transacoes.indexOf(transacao);
                const row = document.createElement('tr');
                
                const valorFormatado = transacao.valor.toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                });

                const dataFormatada = new Date(transacao.data + 'T00:00:00').toLocaleDateString('pt-BR');

                row.innerHTML = `
                    <td><i class="fas fa-grip-vertical sortable-handle"></i></td>
                    <td>${transacao.descricao}</td>
                    <td style="color: ${transacao.tipo === 'receita' ? '#28a745' : '#dc3545'}">${valorFormatado}</td>
                    <td><span style="background: ${transacao.tipo === 'receita' ? '#28a745' : '#dc3545'}; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">${transacao.tipo.toUpperCase()}</span></td>
                    <td>${dataFormatada}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="button edit" onclick="editarTransacao(${originalIndex})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="button delete" onclick="excluirTransacao(${originalIndex})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;

                tabelaTransacoesBody.appendChild(row);
            });
        }

        // Função para atualizar resumo financeiro
        function atualizarResumoFinanceiro() {
            const receitas = transacoes.filter(t => t.tipo === 'receita').reduce((sum, t) => sum + t.valor, 0);
            const despesas = transacoes.filter(t => t.tipo === 'despesa').reduce((sum, t) => sum + t.valor, 0);
            const saldo = receitas - despesas;

            saldoTotalElement.textContent = saldo.toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });

            saldoTotalElement.style.color = saldo >= 0 ? '#28a745' : '#dc3545';

            // Atualizar gráfico
            atualizarGrafico(receitas, despesas);
        }

        // Função para atualizar gráfico
        function atualizarGrafico(receitas, despesas) {
            const ctx = document.getElementById('resumoChart').getContext('2d');

            if (resumoChart) {
                resumoChart.destroy();
            }

            resumoChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Receitas', 'Despesas'],
                    datasets: [{
                        data: [receitas, despesas],
                        backgroundColor: ['#28a745', '#dc3545'],
                        borderColor: ['#ffffff', '#ffffff'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#ffffff',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
        }

        // Função para exportar para PDF
        function exportarPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(20);
            doc.text('Relatório Financeiro', 20, 20);

            const tableData = transacoes.map(t => [
                t.descricao,
                t.valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }),
                t.tipo.toUpperCase(),
                new Date(t.data + 'T00:00:00').toLocaleDateString('pt-BR')
            ]);

            doc.autoTable({
                head: [['Descrição', 'Valor', 'Tipo', 'Data']],
                body: tableData,
                startY: 30
            });

            doc.save('relatorio-financeiro.pdf');
        }

        // Função para exportar para CSV
        function exportarCsv() {
            const headers = ['Descrição', 'Valor', 'Tipo', 'Data'];
            const csvContent = [
                headers.join(','),
                ...transacoes.map(t => [
                    `"${t.descricao}"`,
                    t.valor,
                    t.tipo,
                    t.data
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'relatorio-financeiro.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Event listeners
        adicionarTransacaoBtn.addEventListener('click', adicionarTransacao);
        limparFormularioBtn.addEventListener('click', limparFormulario);
        filtroDescricaoInput.addEventListener('input', renderizarTransacoes);
        exportarPdfBtn.addEventListener('click', exportarPdf);
        exportarCsvBtn.addEventListener('click', exportarCsv);

        // Permitir adicionar transação com Enter
        [descricaoInput, valorInput, dataInput].forEach(input => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    adicionarTransacao();
                }
            });
        });

        // Carregar transações ao inicializar
        carregarTransacoes();
    </script>
</body>
</html>

